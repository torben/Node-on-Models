// Generated by CoffeeScript 1.6.3
namespace("viewControllers");

tt.viewControllers.NavigationViewController = (function() {
  NavigationViewController.prototype.navigationView = null;

  NavigationViewController.prototype.collection = null;

  NavigationViewController.prototype.oldPermalink = null;

  function NavigationViewController(options) {
    if (options == null) {
      options = {};
    }
    this.navigations = options.navigations;
    this.router = options.router;
    this.collection = new Backbone.Collection;
    this.navigationView = new tt.views.NavigationsView({
      collection: this.navigations,
      router: this.router
    });
  }

  NavigationViewController.prototype.setCurrentNavigation = function(currentNavigation) {
    this.navigationView.setCurrentClass(currentNavigation.get("permalink"));
    if (this.oldPermalink != null) {
      $("body").removeClass(this.oldPermalink);
    }
    this.oldPermalink = currentNavigation.get("permalink");
    return $("body").addClass(this.oldPermalink);
  };

  NavigationViewController.prototype.get = function(field, options) {
    return this.navigationView.model.get(field, options);
  };

  NavigationViewController.prototype.set = function(field, options) {
    return this.navigationView.model.set(field, options);
  };

  NavigationViewController.prototype.setView = function(view) {
    var model,
      _this = this;
    this.collection.each(function(model) {
      var oldView;
      oldView = model.get("view");
      return _this.removeModel(model);
    });
    model = new Backbone.Model({
      view: view
    });
    this.collection.add(model);
    return $(".main-container").append(view.render().$el);
  };

  NavigationViewController.prototype.removeModel = function(model) {
    this.collection.remove(model);
    return model.get("view").remove();
  };

  NavigationViewController.prototype.pushView = function(view, effect) {
    var effectIn, effectOut, i, model, oldView, timeout, _i, _ref, _results,
      _this = this;
    if (effect == null) {
      effect = "fade";
    }
    switch (effect) {
      case "bounce":
        effectIn = "bounceInLeft";
        effectOut = "bounceOutRight";
        break;
      case "fade":
        effectIn = "fadeIn fast";
        effectOut = "fadeOut fast";
    }
    model = new Backbone.Model({
      view: view
    });
    this.collection.add(model);
    timeout = this.collection.length > 1 ? 300 : 1;
    window.setTimeout(function() {
      $(".main-container").prepend(view.render().$el);
      if (_this.collection.length > 1) {
        return view.$el.addClass(effectIn);
      }
    }, timeout);
    if (this.collection.length > 1) {
      _results = [];
      for (i = _i = _ref = this.collection.length - 1; _ref <= 0 ? _i <= 0 : _i >= 0; i = _ref <= 0 ? ++_i : --_i) {
        model = this.collection.models[i];
        oldView = model.get("view");
        if (i === this.collection.length - 2) {
          oldView.$el.removeClass(effectIn).addClass(effectOut);
          _results.push(window.setTimeout((function() {
            return _this.removeModel(model);
          }), 1300));
        } else if (i < this.collection.length - 3) {
          _results.push(this.removeModel(model));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    }
  };

  return NavigationViewController;

})();
